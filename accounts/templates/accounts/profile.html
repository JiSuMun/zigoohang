{% extends 'base.html' %}
{% load static %}

{% block title %}
  MYPAGE
{% endblock title %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/accounts/profile.css' %}">
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
{% comment %} <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous"> {% endcomment %}
{% endblock head %}

{% block content %}
<div class="profile-wrapper">
  {% comment %} ì‚¬ì´ë“œë°” {% endcomment %}
  <div class="profile-sidebar">
    <a class="{% if not q %} {% else %} pass {% endif %}" href="{% url 'accounts:profile' person.username %}">
      <div class="profile-sidebar-item">
        <span class="material-symbols-outlined">settings</span>
        <p>íšŒì›ì •ë³´</p>
      </div>
    </a>
    <a class="{% if q == 'post' %} {% endif %}" href="{% url 'accounts:profile' person.username %}?q=post">
      <div class="profile-sidebar-item">
        <span class="material-symbols-outlined">notes</span>
        <p>ì‘ì„±ê¸€</p>
      </div>
    </a>
    <a class="{% if q == 'interest' %} {% endif %}" href="{% url 'accounts:profile' person.username %}?q=interest">            
      <div class="profile-sidebar-item">
        <span class="material-symbols-outlined">thumb_up</span>
        <p>ê´€ì‹¬ìƒí’ˆ</p>
      </div>
    </a>
    <a class="{% if q == 'purchase_detail' %} {% endif %}" href="{% url 'accounts:profile' person.username %}?q=purchase_detail">           
      <div class="profile-sidebar-item">
        <span class="material-symbols-outlined">shopping_bag</span>
        <p>êµ¬ë§¤ë‚´ì—­</p> 
      </div>
    </a>
    <a class="{% if q == 'second_detail' %} {% endif %}" href="{% url 'accounts:profile' person.username %}?q=second_detail">            
      <div class="profile-sidebar-item">
        <span class="material-symbols-outlined">recycling</span>
        <p>ì¤‘ê³ ê±°ë˜ë‚´ì—­</p>
      </div>
    </a>
    <a class="{% if q == 'chat_rooms' %} {% endif %}" href="{% url 'accounts:profile' person.username %}?q=chat_rooms">            
      <div class="profile-sidebar-item">
        <span class="material-symbols-outlined">forum</span>
        <p>ì±„íŒ…</p>
      </div>
    </a>
  </div>

  {% comment %} ë°˜ì‘í˜• ì‚¬ì´ë“œë°” {% endcomment %}
  <div class="profile-navbar">
    <a class="{% if not q %} {% else %} pass {% endif %}" href="{% url 'accounts:profile' person.username %}">
      <div class="profile-navbar-item">
        <p>íšŒì›ì •ë³´</p>
      </div>
    </a>
    <a class="{% if q == 'post' %} {% endif %}" href="{% url 'accounts:profile' person.username %}?q=post">
      <div class="profile-navbar-item">
        <p>ì‘ì„±ê¸€</p>
      </div>
    </a>
    <a class="{% if q == 'interest' %} {% endif %}" href="{% url 'accounts:profile' person.username %}?q=interest">            
      <div class="profile-navbar-item">
        <p>ê´€ì‹¬ìƒí’ˆ</p>
      </div>
    </a>
    <a class="{% if q == 'purchase_detail' %} {% endif %}" href="{% url 'accounts:profile' person.username %}?q=purchase_detail">           
      <div class="profile-navbar-item">
        <p>êµ¬ë§¤ë‚´ì—­</p> 
      </div>
    </a>
    <a class="{% if q == 'second_detail' %} {% endif %}" href="{% url 'accounts:profile' person.username %}?q=second_detail">            
      <div class="profile-navbar-item">
        <p>ì¤‘ê³ ê±°ë˜ë‚´ì—­</p>
      </div>
    </a>
    <a class="{% if q == 'chat_rooms' %} {% endif %}" href="{% url 'accounts:profile' person.username %}?q=chat_rooms">            
      <div class="profile-navbar-item">
        <p>ì±„íŒ…</p>
      </div>
    </a>
  </div>

  {% comment %} í˜ì´ì§€ {% endcomment %}
  <div class="profile-page">
    {% if q == 'post' %}
      {% include 'accounts/post.html' %}
    {% elif q == 'interest' %}
      {% include 'accounts/interest.html' %}
    {% elif q == 'purchase_detail' %}
      {% include 'accounts/purchase_detail.html' %}
    {% elif q == 'second_detail' %}
      {% include 'accounts/second_detail.html' %}
    {% elif q == 'chat_rooms' %}
      {% include 'accounts/chat.html' %}
    {% elif not q %}
      <div class="profile-page-info">
        <div class="profile-page-info-header">
          <div class="header-info">
            <div class="header-img">
              {% if request.user.image %}
              <img src="{{ request.user.image.url }}" alt="{{ user.username }}'s Profile Image">
            {% else %}
              <img src="#" alt="noimage">
            {% endif %}
          </div>
          <div class="header-text">
            <div class="header-text-name">
              <h2>{{ user.last_name }} ë‹˜</h2>
              <a href="#">
                <span class="material-symbols-outlined">forum</span>
              </a>
            </div>
            {% if user.is_seller == False %}
              <p class="not_seller">ì¼ë°˜íšŒì›</p>
            {% else %}
              <p class="seller">íŒë§¤ì</p>

              {% endif %}

            </div>
          </div>
          <div class="header-update">
            <a href="{% url 'accounts:update' %}">íšŒì›ì •ë³´ìˆ˜ì •</a>
            <a href="{% url 'accounts:change_password' %}">ë¹„ë°€ë²ˆí˜¸ë³€ê²½</a>
          </div>
        </div>
        <div class="profile-box-text">
        <div class="profile-page-info-main">
          <div class="main-card">
              <span class="main-card-title">ë‚˜ì˜ ì—ì½”í¬ì¸íŠ¸ğŸŒ±</span></span>
              <div class="main-card-content">
                <span>{{ user.points }}</span>
              </div>
          </div>
          <div class="main-card">
            <span class="main-card-title">ë‚˜ì˜ ì¹œêµ¬ê´€ë¦¬ğŸ§¸</span>
            <div class="main-card-content">
              
              {% comment %} íŒ”ë¡œì‰í…ŒìŠ¤íŠ¸ {% endcomment %}
              <div class="d-flex gap-3">
                <p>íŒ”ë¡œì‰ :<button type="button" class="profile--card--btn" data-bs-toggle="modal" data-bs-target="#followingsModal"><p id="followings-count">{{ person.followings.all|length }}</p></button></p>
                <p>íŒ”ë¡œì›Œ :<button type="button" class="profile--card--btn" data-bs-toggle="modal" data-bs-target="#followersModal"><p id="followers-count">{{ person.followers.all|length }}</p></button></p>
              </div>
              {% if request.user != person %}
                <form id="follow-form" data-user-id="{{ person.pk }}" data-username="{{ person.username }}" action="{% url 'accounts:follow' person.pk %}" method="post">
                  {% csrf_token %} 
                    {% if request.user in person.followers.all %}
                      <input class="profile--followbtn" type="submit" value="Unfollow">
                    {% else %}
                      {% if request.user.is_authenticated %}
                        <input class="profile--followbtn" type="submit" value="Follow">
                      {% else %}
                        <input class="profile--followbtn" type="submit" value="Follow" disabled>
                      {% endif %}
                    {% endif %}
                </form>
              {% endif %}
          {% comment %}ëª¨ë‹¬ì°½ {% endcomment %}
          
<!-- íŒ”ë¡œì›Œ Modal -->
<div class="modal fade" id="followersModal" tabindex="-1" aria-labelledby="followersModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content profile--modal--box">
      <div class="modal-header">
        <h1 class="modal-title fs-5"  id="followersModalLabel">íŒ”ë¡œì›Œ</h1>
      </div>
      <div class="modal-body row" id = "f_follower_list">
        {% if request.user != person %}
          <div id="follower-list">
            <ul id="follower-ul"></ul>
          </div>
        {% else %}
          <ul id="follower-ul">
            {% for follower in person.followers.all %}
            <li class="follow--modal">
                <a href="{% url 'accounts:profile' follower.username %}">
                  {% if follower.image %}
                    <div class="profile--image rounded-circle">
                      <img src="{{ follower.image.url }}" alt="follower image" class="object-fit-fill profile">
                    </div>
                  {% else %}
                    <div class="profile--image rounded-circle">
                      <img src="{% static 'image/profile-none.png' %}" alt="follower image" class="object-fit-fill profile">
                    </div>
                  {% endif %}
                  <span>{{ follower.username }}</span>
                </a>
            </li>
            {% empty %}
            <p class="ms-2">íŒ”ë¡œì›Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endfor %}
          </ul>
        {% endif %}
      </div>
      <div class="modal-footer">
        <button type="button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- íŒ”ë¡œì‰ Modal -->
<div class="modal fade" id="followingsModal" tabindex="-1" aria-labelledby="followingsModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content profile--modal--box">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="followingsModalLabel">íŒ”ë¡œì‰</h1>
      </div>
      <div class="modal-body row">
        {% if request.user != person %}
          <div id="following-list">
            <ul id="following-ul"></ul>
          </div>
        {% else %}
          <ul id="following-ul">
            {% for following in person.followings.all %}
            <li class="follow--modal">
                <a href="{% url 'accounts:profile' following.username %}">
                  {% if following.image %}
                    <div class="profile--image rounded-circle">
                      <img src="{{ following.image.url }}" alt="following image" class="object-fit-fill profile">
                    </div>
                  {% else %}
                    <div class="profile--image rounded-circle">
                      <img src="{% static 'image/profile-none.png' %}" alt="following image" class="object-fit-fill profile">
                    </div>
                  {% endif %}
                  <span>{{ following.username }}</span>
                </a>
            </li>
            {% empty %}
            <p class="ms-2">íŒ”ë¡œì‰ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endfor %}
          </ul>
        {% endif %}
      </div>
      <div class="modal-footer">
        <button type="button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>



            </div>
          </div>
        </div>
      </div>
      {% endif %}
  </div>
</div>

<script src="{% static '/js/accounts_follow.js' %}" type="text/javascript"></script>
{% endblock content %}

{% comment %} ìœ„ì— ìˆë˜ í•­ëª©ë“¤ì„ ì™¼ìª½ ì‚¬ì´ë“œë°”ë¡œ ë§Œë“¤ê¸° / ë°˜ì‘í˜• í•  ë•Œ ë°‘ìœ¼ë¡œ ë‚´ë¦¬ê¸° {% endcomment %}
{% comment %} ì‚¬ì´ë“œë°”ì— ì±„íŒ…ë„ ì¶”ê°€í•˜ê¸° {% endcomment %}
